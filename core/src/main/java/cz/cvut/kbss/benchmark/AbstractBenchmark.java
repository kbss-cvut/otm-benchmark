package cz.cvut.kbss.benchmark;

import cz.cvut.kbss.benchmark.util.Constants;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public abstract class AbstractBenchmark {

    protected static final Logger LOG = LoggerFactory.getLogger(AbstractBenchmark.class);

    protected static final String CREATE = "create";
    protected static final String BATCH_CREATE = "create-batch";
    protected static final String RETRIEVE = "retrieve";
    protected static final String UPDATE = "update";
    protected static final String DELETE = "delete";

    protected void run(String[] args) {
        if (args.length < 1) {
            printHelp();
        }
        registerFactorParameter();
        final String type = args[args.length - 1];
        BenchmarkRunner runner = null;
        try {
            runner = createBenchmarkRunner(type);
        } catch (IllegalArgumentException e) {
            LOG.error("Unable to create benchmark runner.", e);
            printHelp();
            System.exit(1);
        }
        final Benchmark benchmark = new Benchmark(runner, args);
        benchmark.execute();
    }

    protected abstract BenchmarkRunner createBenchmarkRunner(String type);

    /**
     * The factor parameter is used to scale the size of the data set generated by the {@link cz.cvut.kbss.benchmark.data.DataGenerator}.
     */
    private static void registerFactorParameter() {
        Configuration.registerOption(Constants.FACTOR_PARAMETER,
                "Scale factor. Determines the size of the generated dataset.", Integer.class, 1);
    }

    private static void printHelp() {
        System.out.println("Usage:");
        System.out.println("[execution-configuration] (" + CREATE + '|' + RETRIEVE + '|' + UPDATE + '|' + DELETE + ')');
        System.out.println("execution-configuration: ");
        Configuration.printHelp();
    }
}
